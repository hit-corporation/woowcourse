"use strict";const form=document.forms["form-input"],formSearch=document.forms["form-search"],getAll=async()=>{try{const f=await fetch(BASE_URL+"/kategori/get_all"),j=await f.json();return j}catch(err){console.log(err)}};(async $=>{const allData=await getAll(),tableMain=$("#table-main").DataTable({serverSide:!0,processing:!0,ajax:{url:BASE_URL+"/kategori/get_all_paginated"},pageLength:7,columns:[{data:"id",visible:!1},{data:"category_name",className:"align-middle pl-2"},{data:"parent_category",visible:!1},{data:"parent_category",className:"align-middle",render(data,type,row,_meta){let parent="";return allData.find(x=>x.id==data)&&(parent=allData.find(x=>x.id==data).category_name),parent}},{data:null,render(data,type,row,_meta){const btn='<span class="d-flex flex-nowrap"><button role="button" class="btn-circle btn-success rounded-circle border-0 edit_data"><i class="fas fa-edit"></i></button><button role="button" class="btn-circle btn-danger rounded-circle border-0 delete_data"><i class="fas fa-trash"></i></button></span>';return btn}}]}),treedata=allData.map(x=>({id:x.id,text:x.category_name,parent:null==x.parent_category?"#":x.parent_category}));$("#tree-container").jstree({core:{multiple:!1,data:treedata},checkbox:{three_state:!1,tie_selection:!0},plugins:["checkbox"]}).bind("select_node.jstree",(e,data)=>{document.querySelector('input[name="category_parent"]').value=data.node.id}).bind("deselect_node.jstree",(e,data)=>{document.querySelector('input[name="category_parent"]').value=""}).bind("loaded.jstree",(e,data)=>{document.querySelector('input[name="category_parent"]').value&&$("#tree-container").jstree(!0).select_node(form.category_parent.value)}),document.getElementById("btn-add").addEventListener("click",e=>{form.reset(),form.action=BASE_URL+"kategori/store",$("#tree-container").jstree(!0).deselect_all()}),$("#table-main").on("click","button.edit_data",e=>{let row=tableMain.row($(e.target).parents("tr")[0]).data();form.reset(),form.category_id.value=row.id,form.category_name.value=row.category_name,form.category_parent.value=row.parent_category,$("#tree-container").jstree(!0).deselect_all(),$("#tree-container").jstree(!0).select_node(form.category_parent.value),form.action=BASE_URL+"kategori/edit",$("#modal-input").modal("show")}),$("#table-main").on("click","button.delete_data",e=>{Swal.fire({icon:"warning",title:'<h4 class="text-warning">Apakah anda yakin !?</h4>',html:'<h5 class="text-warning">Data yang di hapus tidak dapat di kembalikan.</h5>',showConfirmButton:!0,showCancelButton:!0,confirmButtonText:"Ya",cancelButtonText:"Tidak"}).then(t=>{if(!t.value)return;let row=tableMain.row($(e.target).parents("tr")[0]).data();loading(),window.location.href=BASE_URL+"kategori/erase/"+row.id})}),form.addEventListener("reset",e=>{$("#tree-container").jstree(!0).deselect_all()}),form.addEventListener("submit",e=>{loading()}),$("#search-tree div:first-child").jstree({core:{multiple:!1,data:treedata},checkbox:{three_state:!1,tie_selection:!0},plugins:["checkbox"]}).bind("select_node.jstree",(e,data)=>{formSearch.s_category_parent.value=data.node.id,formSearch.s_category_parent_text.value=data.node.text}).bind("deselect_node.jstree",(e,data)=>{formSearch.s_category_parent.value="",formSearch.s_category_parent_text.value=""}),$("#search-tree").on("click",e=>{e.stopPropagation()}),formSearch.addEventListener("submit",e=>{e.preventDefault(),formSearch.s_category_name.value&&tableMain.columns(1).search(formSearch.s_category_name.value).draw(),formSearch.s_category_parent.value&&tableMain.columns(2).search(formSearch.s_category_parent.value).draw()}),formSearch.addEventListener("reset",e=>{$("#search-tree div:first-child").jstree(!0).deselect_all(),tableMain.columns(1).search("").draw(),tableMain.columns(2).search("").draw()})})(jQuery);const loading=()=>{Swal.fire({html:'<div class="d-flex flex-column align-items-center"><span class="spinner-border text-primary"></span><h3 class="mt-2">Loading...</h3><div>',showConfirmButton:!1,width:"10rem"})};